---
title: "322 Study Design Project"
author: "Kathleen Zhang, Yura Heo"
date: "October 20th, 2025"
format: 
  pdf:
    documentclass: article
    fontsize: 11pt
geometry: margin=1in
execute: 
  warning: false
  message: false
  echo: false
---

```{r}
library(dplyr)
library(readr)
library(stringr)
library(tibble)
library(survey)
set.seed(322)
```


# 1. 
What is an estimate of the total number of undergraduate students enrolled in colleges?
 Design your survey with the goal of answering this question most accurately.
 
 - Stratified SRS of colleges
 - Strata based school size and public/private
 - 6 strata 
 - sort by name
```{r}

strata_plan <- tribble(
  ~type,    ~size,   ~Nh,  ~nh,
  "Public", "Small",   824,  9,
  "Public", "Medium",  861, 10,
  "Public", "Large",   176,  2,
  "Private","Small",  3130, 35,
  "Private","Medium",  381,  4,
  "Private","Large",    23,  1
) # based on proportional allocation, sums to 60

sample_index_df <- strata_plan %>%
  rowwise() %>%
  mutate(sampled_index = list(sample.int(Nh, size = nh, replace = FALSE))) %>%
  tidyr::unnest(sampled_index) %>%
  ungroup()

# Leave name and undergrad_enrollment blank/NA to enter later.
template <- sample_index_df %>%
  mutate(
    stratum = paste(type, size, sep = "_"),
    weight  = Nh / nh,   # HT weight for each sampled unit in stratum
    fpc     = Nh         # finite population correction (for variance)
  ) %>%
  select(stratum, type, size, Nh, nh, sampled_index, weight, fpc) %>%
  mutate(
    school_name = "",               # <-- fill manually
    undergrad_enrollment = NA_real_, # <-- fill manually
  )

write_csv(template, "question 1.csv")

```
 
We estimated the total number of U.S. undergraduates using a stratified simple random sample from the College Scorecard. We defined six strata by crossing school type (Public vs. Private, where Private combines non-profit and for-profit) with size (Small, Medium, Large). For each stratum, we constructed a sampling frame directly from the Scorecard search pages filtered to undergraduate-granting programs, then randomly sampled institutions within stratum. we recorded each sampled school’s undergraduate enrollment and used a Horvitz–Thompson estimator for the population total with stratum weights $w_h = N_h/n_h$ and finite population corrections $N_h$. Because one of the strata (Private–Large) contained only a single sampled institution, a lonely PSU adjustment was applied using the "adjust" method in the survey package. This method inflates the estimated variance slightly to account for strata with only one primary sampling unit (PSU), providing a more conservative and reliable confidence interval.


This stratification targets the main drivers of enrollment (size and sector), yielding higher precision than a single SRS.

```{r}

options(survey.lonely.psu = "adjust")

q1 <- read_csv("question 1.csv", show_col_types = FALSE)

design <- svydesign(
  id = ~1,
  strata = ~stratum,
  weights = ~weight,
  fpc = ~fpc,
  data = q1
)

total_est <- svytotal(~undergrad_enrollment, design, na.rm = TRUE)
total_est
confint(total_est)


```
The Horvitz–Thompson estimator produced an estimated total undergraduate enrollment of 15,598,354 students, with a standard error (SE) of approximately 1,786,576. The 95% confidence interval for the total enrollment ranges from 12,096,730 to 19,099,978 students.
 
 # 2. 
 What fraction of colleges have a major in statistical science? Use your sample to estimate
 this fraction; do not get the answer by filtering the schools.
 
 - Stratified SRS of colleges
 - Strata based school size and public/private
 - 6 strata 
 - sort by name
 
 # 3. 
 What is the average of the median earnings among alumni from public schools? From private
 schools (combine for profit and not for profit private schools)?
 
 
 - Stratified SRS for average cost
```{r}
strata_plan3 <-  tribble(
  ~type,        ~avg_annual_cost,   ~Nh,   ~nh,
  "Public",     "<=20k",       1691,  18,
  "Public",     ">20k",       201,  2,
  "Private",    "<=20k",       1510,  16,
  "Private",    ">20k",       2144,  24,
) 

sample_index_df3 <- strata_plan3 %>%
  rowwise() %>%
  mutate(sampled_index = list(sample.int(Nh, size = nh, replace = FALSE))) %>%
  tidyr::unnest(sampled_index) %>%
  ungroup()

# Create template for data collection
template3 <- sample_index_df3 %>%
  mutate(
    stratum = paste(type, avg_annual_cost, sep = "_"),
    weight  = Nh / nh,  # HT weight
    fpc     = Nh
  ) %>%
  select(stratum, type, avg_annual_cost, Nh, nh, sampled_index, weight, fpc) %>%
  mutate(
    school_name = "",
    median_earning = NA_real_
  )

write_csv(template3, "question 3.csv")

```
 

 
 
 # 4. 
  Answer one other question that interests you from the data that you could collect from the
 website.
 
 
 NOrth Carolina undergrad students: average annual cost proportional to student faculty ratio